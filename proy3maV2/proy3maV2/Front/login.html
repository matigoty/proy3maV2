<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión - Tekoá</title>
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        body::before {
            content: '';
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1;
        }
        
        .floating-elements {
            position: absolute;
            width: 100%; height: 100%;
            overflow: hidden;
            z-index: 0;
        }
        
        .floating-element {
            position: absolute;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
            color: white;
        }
        
        .floating-element:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .floating-element:nth-child(2) { top: 60%; right: 10%; animation-delay: 2s; }
        .floating-element:nth-child(3) { bottom: 20%; left: 20%; animation-delay: 4s; }
        .floating-element:nth-child(4) { top: 30%; right: 30%; animation-delay: 1s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }
        
        .login-container { position: relative; z-index: 2; width: 100%; max-width: 500px; margin: 0 auto; }
        
        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 3rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .login-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 35px 60px rgba(0, 0, 0, 0.3);
        }
        
        .brand-logo { text-align: center; margin-bottom: 2rem; }
        .brand-logo i { font-size: 3rem; color: #667eea; margin-bottom: 1rem; }
        .brand-title { font-size: 2rem; font-weight: 700; color: #333; margin-bottom: 0.5rem; }
        .brand-subtitle { color: #666; font-size: 0.9rem; margin-bottom: 2rem; }
        
        .form-group { margin-bottom: 1.5rem; position: relative; }
        
        .form-control {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px 15px 50px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            background: white;
        }
        
        .form-icon {
            position: absolute; left: 18px; top: 50%;
            transform: translateY(-50%);
            color: #667eea; font-size: 1.1rem;
        }
        
        .btn-login {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none; border-radius: 15px;
            padding: 15px; font-weight: 600; font-size: 1.1rem;
            color: white; width: 100%; transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }
        
        .btn-login:active { transform: translateY(0); }
        
        .divider { text-align: center; margin: 2rem 0; position: relative; }
        .divider::before { content: ''; position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: #e0e0e0; }
        .divider span { background: rgba(255, 255, 255, 0.95); padding: 0 1rem; color: #474545; font-size: 0.9rem; }
        
        .back-link { text-align: center; margin-top: 1.5rem; }
        .back-link a { color: #667eea; text-decoration: none; font-weight: 500; transition: all 0.3s ease; }
        .back-link a:hover { color: #764ba2; text-decoration: underline; }
        
        .forgot-password { text-align: center; margin-top: 1rem; }
        .forgot-password a { color: #667eea; text-decoration: none; font-size: 0.9rem; transition: all 0.3s ease; }
        .forgot-password a:hover { color: #764ba2; text-decoration: underline; }
        
        .alert { border-radius: 15px; border: none; padding: 15px; margin-bottom: 1.5rem; }
        .alert-success { background: rgba(40, 167, 69, 0.1); color: #28a745; border-left: 4px solid #28a745; }
        .alert-danger { background: rgba(220, 53, 69, 0.1); color: #dc3545; border-left: 4px solid #dc3545; }
        
        @media (max-width: 768px) {
            .login-card { margin: 1rem; padding: 2rem; }
            .brand-title { font-size: 1.5rem; }
        }
        
        .loading { display: none; }
        .loading.show { display: inline-block; }
        
        .btn-login.loading { position: relative; color: transparent; }
        .btn-login.loading::after {
            content: ''; position: absolute; width: 20px; height: 20px; top: 50%; left: 50%;
            margin-left: -10px; margin-top: -10px; border: 2px solid transparent;
            border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite;
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="floating-elements">
        <div class="floating-element"><i class="fas fa-users" style="font-size: 4rem;"></i></div>
        <div class="floating-element"><i class="fas fa-handshake" style="font-size: 3.5rem;"></i></div>
        <div class="floating-element"><i class="fas fa-chart-line" style="font-size: 4.5rem;"></i></div>
        <div class="floating-element"><i class="fas fa-building" style="font-size: 3rem;"></i></div>
    </div>

    <div class="container">
        <div class="login-container">
            <div class="login-card">
                <div class="brand-logo">
                    <i class="fas fa-users"></i>
                    <h1 class="brand-title">Tekoá</h1>
                    <p class="brand-subtitle">Comunidad Organizada</p>
                </div>

                <!-- Alert container -->
                <div id="alertContainer"></div>

                <form id="loginForm">
                    <div class="form-group">
                        <i class="fas fa-envelope form-icon"></i>
                        <input type="email" class="form-control" id="usr_email_login" name="usr_email_login" placeholder="Tu correo electrónico" required>
                    </div>
                    <div class="form-group">
                        <i class="fas fa-lock form-icon"></i>
                        <input type="password" class="form-control" id="usr_pass_login" name="usr_pass_login" placeholder="Tu contraseña" required>
                    </div>
                    <button type="submit" class="btn btn-login" id="loginBtn">
                        <i class="fas fa-sign-in-alt me-2"></i> Iniciar Sesión
                    </button>
                </form>

                <div class="forgot-password">
                    <a href="#" onclick="showAlert('info', 'Funcionalidad próximamente disponible')">¿Olvidaste tu contraseña?</a>
                </div>

                <div class="divider"><span>¿No tienes cuenta?</span></div>

                <div class="back-link">
                    <a href="registro.html"><i class="fas fa-user-plus me-1"></i> Crear cuenta nueva</a>
                </div>
                <div class="back-link">
                     <a href="../Front/index.php"><i class="fas fa-arrow-left me-1"></i> Volver al inicio</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Función para mostrar alertas
        function showAlert(type, message) {
            const alertContainer = document.getElementById('alertContainer');
            const alertClass = type === 'success' ? 'alert-success' : 
                              type === 'error' ? 'alert-danger' : 'alert-info';
            
            const alertHTML = `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            alertContainer.innerHTML = alertHTML;
            
            setTimeout(() => {
                const alert = alertContainer.querySelector('.alert');
                if (alert) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 5000);
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const loginBtn = document.getElementById('loginBtn');
            const email = form.usr_email_login.value.trim();
            const password = form.usr_pass_login.value.trim();
            
            if (!email || !password) {
                showAlert('error', 'Por favor, completa todos los campos');
                return;
            }
            if (!isValidEmail(email)) {
                showAlert('error', 'Por favor, ingresa un email válido');
                return;
            }
            
            loginBtn.classList.add('loading');
            loginBtn.disabled = true;
            
            const data = { usr_email: email, usr_pass: password };
            
            fetch('../API/api.php/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',   // guarda sesión
                body: JSON.stringify(data)
            })
            .then(response => response.text().then(text => ({ status: response.status, text })))
            .then(({ status, text }) => {
                try {
                    const data = JSON.parse(text);
                 if (status >= 200 && status < 300 && data.success) {
                    //Usuario aprobado
                    showAlert('success', '¡Inicio de sesión exitoso! Redirigiendo...');
                     setTimeout(() => {
                  window.location.href = '../API_cooperativa/panel_usuario.php';
                    }, 2000);

                    } else if (data.status === "pendiente") {
                    // Usuario pendiente
                showAlert('info', 'Tu cuenta está pendiente de aprobación. Por favor, espera la validación de un administrador.');

                    } else if (data.status === "rechazado") {
                    //Usuario rechazado
                showAlert('error', 'Tu registro fue rechazado. Contacta con la administración.');

                    } else if (data.error) {
                    //Error genérico
                    showAlert('error', 'Error al iniciar sesión: ' + data.error);

                    } else {
                    // Cualquier otro caso
                    showAlert('error', 'Credenciales incorrectas. Verifica tu email y contraseña.');
                    }

                } catch (e) {
                    console.error("No se pudo parsear JSON:", text);
                    showAlert('error', 'Error del servidor. Por favor, intenta más tarde.');
                }
            })
            .catch(error => {
                console.error("Error en la solicitud:", error);
                showAlert('error', 'No se pudo conectar con el servidor. Verifica tu conexión.');
            })
            .finally(() => {
                loginBtn.classList.remove('loading');
                loginBtn.disabled = false;
            });
        });
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // Animación al cargar
        window.addEventListener('load', function() {
            const loginCard = document.querySelector('.login-card');
            loginCard.style.opacity = '0';
            loginCard.style.transform = 'translateY(30px)';
            setTimeout(() => {
                loginCard.style.transition = 'all 0.6s ease';
                loginCard.style.opacity = '1';
                loginCard.style.transform = 'translateY(0)';
            }, 100);
        });
        
        // Enter key
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const loginBtn = document.getElementById('loginBtn');
                if (!loginBtn.disabled) {
                    loginBtn.click();
                }
            }
        });
    </script>
</body>
</html>
